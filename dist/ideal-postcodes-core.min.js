/**
 * ideal-postcodes-core - Ideal Postcodes core frontend javascript library
 * @version v0.0.1
 * @link https://ideal-postcodes.co.uk/
 * @license MIT
 */

;(function(window, document) {
"use strict";

var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},IdealPostcodes;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this),this.message="Ideal Postcodes Error: "+t.message}return __extends(t,e),t}(Error);e.IdealPostcodesError=t;var r=function(e){function t(){e.call(this,{message:"Unable to parse JSON response"})}return __extends(t,e),t}(t);e.JsonParseError=r}(t=e.Errors||(e.Errors={}))}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){var t;!function(e){e.parse=function(o){var s,u=o.status;if(200!==u){switch(u){case 503:return new r}try{s=JSON.parse(o.responseText)}catch(a){return new e.JsonParseError}var i=s.code,c=s.message;return void 0===i||void 0===c?new n:new t({responseCode:i,status:u,message:c})}};var t=function(e){function t(t){e.call(this,t),t.status&&(this.status=t.status),t.responseCode&&(this.responseCode=t.responseCode)}return __extends(t,e),t}(e.IdealPostcodesError);e.IdealPostcodesApiError=t;var r=function(e){function t(){e.call(this,{status:503,message:"Rate Limit Reached. Please wait a while before you retry your request"})}return __extends(t,e),t}(t);e.RateLimitError=r;var o=function(e){function t(){e.call(this,{message:"Request timed out"})}return __extends(t,e),t}(t);e.RequestTimeoutError=o;var n=function(e){function t(){e.call(this,{message:"Unknown AJAX error occurred when accessing API"})}return __extends(t,e),t}(t);e.GenericApiError=n}(t=e.Errors||(e.Errors={}))}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){var t;!function(t){t.getXhr=function(){try{return new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0")}catch(e){return null}},t.detectTls=function(e){try{return"http:"!==e.location.protocol}catch(t){return!0}},t.defaultHeaders={Accept:"text/javascript, application/javascript"},t.generateQueryString=function(e){var t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")};var r=/^\s*$/;t.xhrRequest=function(o,n){var s=o.url,u=o.timeout||e.DEFAULT_TIMEOUT,a=o.data||null,i=e.Utils.extend({},t.defaultHeaders,o.headers||{}),c=o.method||"GET",l=t.generateQueryString(o.queryString||{});l.length>0&&(s+="?"+l);var d=t.getXhr();d.open(c,s,!0);try{for(var p in i)d.setRequestHeader(p,i[p])}catch(h){}var f=setTimeout(function(){d.onreadystatechange=function(){},d.abort(),n(new Error("Request timeout"),null,d)},u);return d.onreadystatechange=function(){var t;if(4===d.readyState){if(clearTimeout(f),200!==d.status)return n(e.Errors.parse(d),{},d);try{t=r.test(d.responseText)?{}:JSON.parse(d.responseText)}catch(o){return n(new Error("parsererror"),null,d)}return n(null,t,d)}},d.send(a),d}}(t=e.Transport||(e.Transport={}))}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){e.API_URL="api.ideal-postcodes.co.uk",e.TLS=e.Transport.detectTls(window),e.VERSION="v1",e.DEFAULT_TIMEOUT=1e4}(IdealPostcodes||(IdealPostcodes={})),window.IdealPostcodes=IdealPostcodes;var IdealPostcodes;!function(e){var t;!function(e){e.extend=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var o=t.length,n=0;o>n;n++){var s=t[n];for(var u in s)void 0!==s[u]&&(e[u]=s[u])}return e}}(t=e.Utils||(e.Utils={}))}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){var t=function(){function e(){this.store={postcodeStore:{},addressStore:{},autocompleteStore:{},udprnStore:{},umprnStore:{}}}return e.prototype.cacheAddressQuery=function(e,t){this.store.addressStore[e]=t},e.prototype.getAddressQuery=function(e){return this.store.addressStore[e]},e.prototype.cachePostcodeQuery=function(e,t){this.store.postcodeStore[e]=t},e.prototype.getPostcodeQuery=function(e){return this.store.postcodeStore[e]},e.prototype.cacheAutocompleteQuery=function(e,t){this.store.autocompleteStore[e]=t},e.prototype.getAutocompleteQuery=function(e){return this.store.autocompleteStore[e]},e.prototype.cacheUdprnQuery=function(e,t){this.store.udprnStore[e]=t},e.prototype.getUdprnQuery=function(e){return this.store.udprnStore[e]},e.prototype.cacheUmprnQuery=function(e,t){this.store.umprnStore[e]=t},e.prototype.getUmprnQuery=function(e){return this.store.umprnStore[e]},e}();e.Cache=t}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){var t;!function(e){var t=function(){return Date.now()};e.debounce=function(e,r){function o(){var c=t()-a;c>0&&r>c?n=setTimeout(o,r-c):(n=null,i=e.apply(u,s),n||(u=s=null))}void 0===r&&(r=100);var n,s,u,a,i;return function(){return u=this,s=arguments,a=t(),n||(n=setTimeout(o,r)),i}}}(t=e.Utils||(e.Utils={}))}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){var t;!function(e){e.AllowedAuthorizationParameters=["api_key"],e.constructHeaders=function(t){var r={};return r.Authorization=e.constructAuthenticationHeader(t),r},e.constructAuthenticationHeader=function(t){for(var r=[],o=0;o<e.AllowedAuthorizationParameters.length;o++){var n=e.AllowedAuthorizationParameters[o];void 0!==t[n]&&r.push(n+'="'+t[n]+'"')}return 0===r.length?"":"IDEALPOSTCODES "+r.join(" ")},e.constructQueryString=function(e){var t={};return e.filter&&(t.filter=e.filter.join(",")),e.licensee&&(t.licensee=e.licensee),e.tags&&(t.tags=e.tags.join(",")),t},e.constructAutocompleteQueryString=function(e){var t={};return t.query=e.query,t},e.constructAddressQueryString=function(e){var t={};return t.query=e.query,t.page=e.page||0,t.limit=e.limit||10,t}}(t=e.XhrUtils||(e.XhrUtils={}))}(IdealPostcodes||(IdealPostcodes={}));var IdealPostcodes;!function(e){var t=e.Utils.extend,r=e.XhrUtils.constructHeaders,o=e.XhrUtils.constructQueryString,n=e.XhrUtils.constructAddressQueryString,s=e.XhrUtils.constructAutocompleteQueryString,u=function(){function u(t){var r=this;void 0===t&&(t={}),this.api_key=t.api_key,this.tls=void 0===t.tls?e.TLS:t.tls,this.version=void 0===t.version?e.VERSION:t.version,this.baseUrl=void 0===t.baseUrl?e.API_URL:t.baseUrl,this.cache=new e.Cache;var o=this;this.autocompleteCallback=function(){},this.debouncedAutocomplete=e.Utils.debounce(function(e){r.lookupAutocomplete(e,o.autocompleteCallback)})}return u.prototype.apiUrl=function(){return"http"+(this.tls?"s":"")+"://"+this.baseUrl+"/"+this.version},u.prototype.ping=function(t){e.Transport.xhrRequest({url:"http"+(this.tls?"s":"")+"://"+this.baseUrl},t)},u.prototype.lookupPostcode=function(t,n){var s=this;t.api_key=this.api_key;var u=r(t),a=o(t),i=t.postcode,c=this.cache.getPostcodeQuery(i);return c?n(null,c):void e.Transport.xhrRequest({url:this.apiUrl()+"/postcodes/"+encodeURIComponent(t.postcode),headers:u,queryString:a},function(e,t,r){return e&&4040===e.responseCode?n(null,[],r):e?n(e,null,r):(s.cache.cachePostcodeQuery(i,t.result),n(null,t.result,r))})},u.prototype.lookupAddress=function(s,u){var a=this;s.api_key=this.api_key;var i=r(s),c=o(s);t(c,n(s));var l=s.query,d=this.cache.getAddressQuery(l);return d?u(null,d):void e.Transport.xhrRequest({url:this.apiUrl()+"/addresses",headers:i,queryString:c},function(e,t,r){return e?u(e,null,r):(a.cache.cacheAddressQuery(l,t.result),u(null,t.result,r))})},u.prototype.lookupAutocomplete=function(n,u){var a=this;n.api_key=this.api_key;var i=r(n),c=o(n);t(c,s(n));var l=n.query,d=this.cache.getAutocompleteQuery(l);return d?u(null,d):void e.Transport.xhrRequest({url:this.apiUrl()+"/autocomplete/addresses",headers:i,queryString:c},function(e,t,r){return e?u(e,null,r):(a.cache.cacheAutocompleteQuery(l,t.result),u(null,t.result,r))})},u.prototype.lookupUdprn=function(t,n){var s=this;t.api_key=this.api_key;var u=r(t),a=o(t),i=t.id,c=this.cache.getUdprnQuery(i);return c?n(null,c):void e.Transport.xhrRequest({url:this.apiUrl()+"/udprn/"+i,headers:u,queryString:a},function(e,t,r){return e?n(e,null,r):(s.cache.cacheUdprnQuery(i,t.result),n(null,t.result,r))})},u.prototype.lookupUmprn=function(t,n){var s=this;t.api_key=this.api_key;var u=r(t),a=o(t),i=t.id,c=this.cache.getUmprnQuery(i);return c?n(null,c):void e.Transport.xhrRequest({url:this.apiUrl()+"/umprn/"+i,headers:u,queryString:a},function(e,t,r){return e?n(e,null,r):(s.cache.cacheUmprnQuery(i,t.result),n(null,t.result,r))})},u.prototype.checkKeyUsability=function(t){e.Transport.xhrRequest({url:this.apiUrl()+"/keys/"+this.api_key},function(e,r,o){return e?t(e,null,o):t(null,r.result,o)})},u.prototype.autocompleteAddress=function(e){this.debouncedAutocomplete(e)},u.prototype.registerAutocompleteCallback=function(e){this.autocompleteCallback=e},u}();e.Client=u}(IdealPostcodes||(IdealPostcodes={}));
}(window, document));
